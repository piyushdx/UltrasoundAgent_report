
ele1 = {
    "title" : "",
    "content" : {
        "1 extra" : "Ultrasound assessment is an accurate method of determining gestational age, fetal number, viability, and placental location, and it is recommended for all pregnant patients. Though fetal anatomy survey (CPT® 76805/CPT® 76811 if high-risk) can be performed as early as 14 weeks gestation, per ACOG, in the absence of other specific indications, the optimal time for a single ultrasound examination is at 18 to 22 weeks of gestation.",
        "16 G":"For a Normal (Low Risk) Pregnancy report a fetal anatomy ultrasound CPT ®76805 if ≥16 weeks",
        "14 L":"If pregnancy is High Risk can report:\nA detailed first-trimester obstetric ultrasound3,15 [requested as CPT® 76801 plus CPT® 76813 (and CPT® 76802 plus CPT® 76814 for each additional fetus)] between 12 weeks 0 days and 13 weeks 6 days (if indicated)",
        "16 G":"A detailed fetal anatomy ultrasound (CPT® 76811) if ≥16 weeks",
        "2 extra":"Current ACOG and SMFM guidelines state that cervical length (CL) screening in singleton gestations without a prior spontaneous preterm birth (PTB) cannot yet be universally mandated.\nTransvaginal ultrasound (CPT® 76817) can be performed if the transabdominal CL is ≤3.6 cm. \n\n Fetal Nuchal Translucency (CPT® 76813) can be performed if Cell-Free DNA (cfDNA) is not planned or has not already been performed, as they are both screening tools for fetal aneuploidy.",
    },
    "page" : "8"
}


ele2 = {
    "title" : "Uncertain Dates/Unknown Last Menstrual Period (LMP)",
    "content" : {
        "1 extra" : "If there is a difference in the clinical size of the uterus on pelvic exam and the estimated gestational age calculated by the LMP or there is an uncertain/unknown LMP or there have been irregular periods in the last year, one of the following can be performed:",
        "14 L" : "If <14 weeks by pelvic exam CPT® 76801 one time (plus CPT® 76802 for each additional fetus) and/or CPT® 76817 one time if a complete ultrasound has not yet been performed\n- CPT®76801 is preferred for dating, but if this is unable to be completed then CPT® 76815 and/or CPT® 76817 for a transvaginal ultrasound is indicated",
        "14 G" : "If ≥14 weeks by abdominal exam CPT® 76815 or CPT® 76805 (CPT® 76811 if high risk) if complete fetal anatomic scan has not yet been performed",
        "2 extra":"Background and Supporting Information:\nCPT® 76815 should never be reported with complete studies CPT ® 76801/CPT® 76802, CPT® 76805/CPT® 76810 or CPT® 76811/CPT® 76812 or with CPT® 76816 or BPP (CPT® 76818 and CPT® 76819).\n- Though a fetal anatomy survey (CPT® 76805/CPT® 76811) can be performed as early as 14 weeks gestation, per ACOG, in the absence of other specific indications, it is optimally performed at 18 to 22 weeks of gestation."
    },
    "page" : "17"
}
ele3 = {
    "title" : "Locate an Intrauterine Device (IUD)",
    "content" : {
        "14 L" : "CPT 76801 and/or CPT 76817 if <14 weeks and a complete ultrasound has not yet been performed",
        "14 G" : "CPT® 76815 and/or CPT® 76817 if complete ultrasound has already been performed or if ≥14 weeks.",
        "16 G" : "CPT® 76805 (CPT® 76811 if otherwise indicated), if ≥16 weeks when an anatomy ultrasound (CPT® 76805/CPT® 76811) has not yet been performed, and 3-D Rendering (CPT® 76376/CPT® 76377) can be added for suspected retained IUD",
        "1 extra" : "Background and Supporting Information:\n- CPT® 76815 should never be reported with complete studies CPT ® 76801/CPT® 76802, CPT® 76805/CPT® 76810 or CPT® 76811/CPT® 76812 or with CPT® 76816 or BPP (CPT® 76818 and CPT® 76819).\n- Though fetal anatomy survey (CPT® 76805/CPT® 76811) can be performed as early as 14 weeks gestation, per ACOG, in the absence of other specific indications, it is optimally performed at 18 to 22 weeks of gestation.",
    },
    "page" : "20"
}

ele4 = {
    "title" : "History of Infertility",
    "content" : {
        "1 extra" : "If the current or a prior pregnancy was conceived using an ovulation induction agent (for example Clomid) and/or by intrauterine insemination (IUI), or If there is a history of infertility or history of IVF in a prior pregnancy Report:",
        "14 L":"Complete first trimester ultrasound CPT® 76801 [plus CPT® 76802 for each additional fetus] if <14 weeks and a complete ultrasound has not yet been performed, and/or CPT® 76817 for a transvaginal ultrasound\n- CPT® 76801 is preferred for dating, but if this is unable to be completed then CPT® 76815 and/or CPT® 76817 for a transvaginal ultrasound is indicated",
        "16 G":"CPT® 76805 if ≥16 weeks, when complete fetal anatomic scan has not yet been performed",
        "2 extra":"Background and Supporting Information:\n- CPT® 76815 should never be reported with complete studies CPT ® 76801/CPT® 76802, CPT® 76805/CPT® 76810 or CPT® 76811/CPT® 76812 or with CPT® 76816 or BPP (CPT® 76818 and CPT® 76819).\n- Though fetal anatomy survey (CPT® 76805/CPT® 76811) can be performed as early as 14 weeks gestation, per ACOG, in the absence of other specific indications, it is optimally performed at 18 to 22 weeks of gestation.",
    },
    "page" : "24"

}

ele5 = {
    "title" : "High Risk Group One - Risk Factors | Socio-Demographic Risk Factors (maternal age)",
    "content" : {
        "1 extra" : "Age ≥35 years of age at the estimated date of confinement (EDC)",
        "14 L" : "Complete first trimester ultrasound CPT® 76801 [plus CPT® 76802 for each additional fetus] if <14 weeks and a complete ultrasound has not yet been performed, and/or CPT® 76817 for a transvaginal ultrasound. CPT® 76801 is preferred for dating, but if this is unable to be completed, then CPT® 76815 and/or CPT® 76817 for a transvaginal ultrasound is indicated.",
        "16 G" : "Detailed Fetal Anatomic Scan CPT® 76811 if ≥16 weeks: \nThough CPT® 76811 can be performed as early as 14 weeks gestation, per ACOG, in the absence of other specific indications, it is optimally performed at 18 to 22 weeks of gestation.",
        "2 extra" : "Starting at 23 weeks, follow-up growth scans (CPT® 76816) every 3 to 6 weeks.\nBPP (CPT® 76818 or CPT® 76819) or modified BPP (CPT® 76815), weekly starting at 32 weeks.",
        "3 extra" : "Starting at 32 weeks, perform BPP (CPT® 76818 or CPT® 76819) or modified BPP (CPT® 76815) up to 2x weekly for the following conditions: - Antiphospholipid Syndrome. - Maternal Renal Disease (moderate to severe with creatinine >1.4mg/dl). - Sickle cell disease.",
        "26 G" : "Starting at diagnosis, perform BPP (CPT® 76818 or CPT® 76819) if ≥26 weeks, or modified BPP (CPT® 76815) if ≥23 weeks, up to 2x weekly for the following conditions: - Intra-hepatic cholestasis of pregnancy (IHCP). - Complicated Sickle cell disease (e.g. co-existing hypertension, vaso-occlusive crisis, fetal growth restriction). - Complicated SLE (e.g. active lupus nephritis, or recent flares). - Major fetal anomaly in the current pregnancy (e.g. gastroschisis, fetal ventriculomegaly, fetal hydronephrosis (>10mm), achondroplasias, fetal congenital heart disease, neural tube defect, sustained fetal arrhythmias)."
    }
}

ele6 = {  
    "title" : "High Risk Medications and Substances - Potentially Teratogenic Medications/Substances",
    "content" : {
        "1 extra" : "If maternal exposure to any of the below Potentially Teratogenic Medications/Substances report:",
        "14 L" : " Complete first trimester anatomy ultrasound CPT® 76801 [plus CPT® 76802 for each additional fetus] if <14 weeks and a complete ultrasound has not yet been performed, and/or CPT® 76817 for a transvaginal ultrasound :  CPT® 76801 is preferred for dating, but if this is unable to be completed then CPT® 76815 and/or CPT® 76817 for a transvaginal ultrasound is indicated.\nA detailed first trimester fetal anatomic evaluation can be performed between 12 weeks 0 days and 13 weeks 6 days. (See Detailed First Trimester Fetal Anatomic Scan (OB-9.12) for indications). \n Report: CPT® 76801 plus CPT® 76813 (and CPT® 76802 plus CPT® 76814 for each additional fetus) for a detailed first trimester fetal anatomy ultrasound.\n A detailed first trimester fetal anatomic evaluation can be performed if indicated, even if cfDNA has been planned or performed.",
        "16 G" : "CPT® 76811 (detailed fetal anatomy) if ≥16 weeks: \nThough fetal anatomy survey (CPT® 76805/CPT® 76811) can be performed as early as 14 weeks gestation, per ACOG, in the absence of other specific indications, it is optimally performed at 18 to 22 weeks of gestation",
        "2 extra" : "Potentially Teratogenic Medications/Substances: Aminoglycosides (amikacin, gentamycin, kanamycin, tobramycin, and other mycins) Aspirin – only if exposed less than 10 weeks gestation Benzodiazepines [e.g., Diazepam (valium), Lorazepam (Ativan), Alprazolam (Xanax) etc.] Codeine Ergotamine (e.g. Methergine) Fluconazole (Diflucan) Lead (Exposure in early pregnancy) Leflunomide (first trimester exposure) Marijuana/Cannabinoids/THC Exposure Methyl mercury Oral contraceptives (combined and/or progestin only exposure in the first trimester) Selective serotonin reuptake inhibitors (SSRI) (e.g., Sertraline (Zoloft), Citalopram (Celexa), Fluoxetine (Prozac) etc.) Serotonin norepinephrine receptor inhibitors (SNRIs) SNRIs (e.g., Venlafexine (Effexor), Duloxetine (Cymbalta), etc.) Serotonin modulators e.g. Trazadone, etc. Tricyclics (e.g., Amitriptyline (Elavil), Imipramine (Tofranil) etc.) Tetracyclines (e.g., Chlortetracycline, Doxycycline, Methacycline, Sumycin, etc.)\nThis is not an all-inclusive list: o See High Risk Group One – Risk Factors (OB 9.1) Health Condition Related Risk Factors (maternal diseases or conditions) or other appropriate guideline for indicated imaging based on disease process being treated. o See Medications/Exposures Associated with Poor Pregnancy Outcome. If documented excessive use (at least weekly) of Marijuana/Cannabinoids/THC in 2nd and/or 3rd trimesters - See High Risk Group One – Risk Factors (OB 9.1). Other atypical antidepressants like Bupropion, Mirtazapine, Nefazodone and Duloxetine have not been linked to an increased risk of fetal anomalies or poor pregnancy outcomes.",
    },
    "page":"82"
}
    
ele7 = {
    "title" : "Medications/ Exposures Associated With Poor Pregnancy Outcome",
    "content" : 
    {
        "1 extra" :"If maternal exposure to any of the Medications or Exposures noted below:",
        "14 L" : "Complete first trimester anatomy ultrasound CPT® 76801 [plus CPT® 76802 for each additional fetus] if <14 weeks and a complete ultrasound has not yet been performed, and/or CPT® 76817 for a transvaginal ultrasound:\n CPT® 76801 is preferred for dating, but if this is unable to be completed then CPT® 76815 and/or CPT® 76817 for a transvaginal ultrasound is indicated.\nA detailed first trimester fetal anatomic evaluation can be performed between 12 weeks 0 days and 13 weeks 6 days. (See Detailed First Trimester Fetal Anatomic Scan (OB-9.12) for indications)\n Report: CPT® 76801 plus CPT® 76813 (and CPT® 76802 plus CPT® 76814 for each additional fetus) for a detailed first trimester fetal anatomy ultrasound\n A detailed first trimester fetal anatomic evaluation can be performed if indicated, even if cfDNA has been planned or performed.",
        "2 extra" : "Medications/Substances associated with poor pregnancy outcome:Anti-convulsants (e.g., Dilantin, Lamictal, Phenobarbital, Tegretol, Valproate etc.) Anti-hypertensive Agents (e.g. ACE inhibitors, Angiotensin II Antagonists, Beta Blockers, etc.) Anti-neoplastic agents (e.g. Daunorubicin etc.) Anti-psychotics (e.g. Abilify, Haldol, Latuda, Seroquel, Stelazine, Thorazine, Zyprexa, etc.) Carbon monoxide Corticosteroids (e.g. Prednisone, Cortisone, etc.) Coumadin/ warfarin Heparin/ Low Molecular Weight Heparin (ongoing use during pregnancy) Immune Modulating Drugs (e.g. Azathioprine, Cyclophosphamide, Cyclosporin A, Hydroxychloroquine, Leflunomide, Mycophenolate mofetil, etc.) Lithium Methimazole Methotrexate ©2022 eviCore healthcare. All Rights Reserved. 84 of 198 400 Buckwalter Place Boulevard, Bluffton, SC 29910 (800) 918-8924 www.eviCore.com Obstetrical (OB) Ultrasound (US) Imaging Guidelines V1.0.2023 Medications/Substances associated with poor pregnancy outcome Mifepristone (RU486) Misoprostol Monoamine oxidase inhibitors e.g. Phenelzine (Nardil) Penicillamine Pregabalin/Lyrica Quinine Retinoic acid/retinoid medications Stimulants (e.g. Ritalin, adderall, etc. and other stimulants used to treat ADHD) Thalidomide.\n This is not an all-inclusive list. See High Risk Group One – Risk Factors (OB 9.1) Health Condition Related (maternal diseases or conditions) or other appropriate guideline for indicated imaging based on the disease process being treated.\nStudies that note lower birth weights among offspring exposed to marijuana have noted that these findings were more pronounced among women who used more marijuana, particularly during the first and second trimesters (at least weekly during the pregnancy). CPT® 76811 can be performed, however, given the limited evidence for antenatally detected abnormal growth, serial growth ultrasounds are not indicated in the absence of other findings concerning for growth restriction. In circumstances where the individual is deemed to have an increased risk for a fetal abnormality and does not have access to a provider who can perform the more desirable fetal and maternal ultrasound with detailed fetal anatomic examination (CPT® 76811) due to geographic or other constraints, a standard (after the first trimester) fetal and maternal ultrasound (CPT® 76805) may be authorized instead. CPT® 76815 should never be reported with complete studies CPT® 76801/CPT® 76802, CPT® 76805/CPT® 76810 or CPT® 76811/CPT® 76812 or with CPT® 76816 or BPP (CPT® 76818 and CPT® 76819). Though fetal anatomy survey (CPT® 76805/CPT® 76811) can be performed as early as 14 weeks gestation, per ACOG, in the absence of other specific indications, it is optimally performed at 18 to 22 weeks of gestation. "
    },
    "page":"84"
    }
    
ele8 =  {
    "title" : "Multiple Gestations - Known Dichorionic Multiple Gestations",
    "content" :
    {
        "1 extra":"For Known dichorionic multiple pregnancies:",
        "14 L" :"Complete first-trimester anatomy ultrasound CPT® 76801 [plus CPT® 76802 for each additional fetus] if <14 weeks and a complete ultrasound has not yet been performed, and/or CPT® 76817 for a transvaginal ultrasound:\n• CPT® 76801 is preferred for dating, but if this is unable to be completed then CPT® 76815 and/or CPT® 76817 for a transvaginal ultrasound is indicated.\nA detailed first-trimester fetal anatomic evaluation3,4 can be performed between 12 weeks 0 days and 13 weeks 6 days. (See Detailed First Trimester Fetal Anatomic Scan (OB-9.12) for indications):\n• Report: CPT® 76801 plus CPT® 76813 (and CPT® 76802 plus CPT® 76814 for each additional fetus) for a detailed first-trimester fetal anatomy ultrasound:\n• A detailed first-trimester fetal anatomic evaluation can be performed if indicated, even if cfDNA has been planned or performed.",
        "2 extra" :"Fetal NT (CPT® 76813) can be performed in twins and higher order multiples even if cfDNA has already been planned or performed.",
        "16 G":"CPT® 76811 and CPT® 76812 for each additional fetus at ≥16 weeks if a complete detailed anatomic scan (CPT® 76811) has not yet been performed:\n• Though fetal anatomy survey (CPT® 76805/CPT® 76811) can be performed as early as 14 weeks gestation, per ACOG, in the absence of other specific indications, it is optimally performed at 18 to 22 weeks of gestation.",
        "3 extra":"Universal cervical length (CL) screening with transvaginal ultrasound (CPT® 76817) is NOT recommended in twin gestations:\n• Transvaginal ultrasound (CPT® 76817) can be performed if the transabdominal cervical length (CL) is ≤3.6 cm. If documented transabdominal attempt fails to visualize cervix, then CPT® 76817 may be performed on a case-by-case basis. See Cervical Length Screening (OB-7.3). If cervical shortening is identified.",
        "14 G":"Growth ultrasound (CPT® 76816) can be done every 4 to 6 weeks at ≥14 weeks.",
        "4 extra": "If otherwise uncomplicated dichorionic twins, perform BPP (CPT® 76818 or CPT® 76819) or modified BPP (CPT® 76815) weekly starting at 36 weeks.\nIf additional risk factors (e.g. diabetes, or hypertensive disease), BPP (CPT® 76818 or CPT® 76819) or modified BPP (CPT® 76815) can be performed weekly starting at 32 weeks or sooner.\nIf FGR or growth discordance ≥20% is diagnosed, you can perform:\nCPT® 76816 (growth ultrasound) every 2 to 4 weeks.\nModified BPP (CPT® 76815) up to twice weekly starting at ≥23 weeks, or BPP (CPT® 76818 or CPT® 76819) up to twice weekly starting at ≥26 weeks.\nUA Doppler (CPT® 76820) weekly (starting at ≥23 weeks).\nIf Severe FGR (EFW ≤3%, AC ≤3%), OR Abnormal UA Doppler studies (defined as a PI, RI, or S/D ratio greater than the 95th percentile for gestational age OR absent or reversed end-diastolic velocity (AEDV or REDV), OR confirmed oligohydramnios:\n• BPP (CPT® 76818 or CPT® 76819 or CPT® 76815) and/or umbilical artery (UA) Doppler (CPT® 76820) may be needed more frequently (2-3 times per week, or even daily).\nIf IVF dichorionic twins, report an initial fetal echo as CPT® 76825 and/or CPT® 76827 with or without CPT® 93325. Trans-abdominal fetal echo is usually not performed prior to 16 weeks."
    },
    "page":"89"

}

# ele1 = {
#     "title" : "",
#     "content" : {
#         "" : "",
#     }
# }



final_ans = ""
for key, value in ele4["content"].items():
    f,s = key.split(" ")
    if s == "extra":
        final_ans += value + "\n"
    elif int(f) >= 15 and s == "G":
        final_ans += value + "\n"
    else:
        pass

print(final_ans)



# # testing
# import openai

# context = """
# Age ≥35 years of age at the estimated date of confinement (EDC)
# Detailed Fetal Anatomic Scan CPT® 76811 if ≥16 weeks: 
# Though CPT® 76811 can be performed as early as 14 weeks gestation, per ACOG, in the absence of other specific indications, it is optimally performed at 18 to 22 weeks of gestation.
# Starting at 23 weeks, follow-up growth scans (CPT® 76816) every 3 to 6 weeks.
# BPP (CPT® 76818 or CPT® 76819) or modified BPP (CPT® 76815), weekly starting at 32 weeks.
# Starting at 32 weeks, perform BPP (CPT® 76818 or CPT® 76819) or modified BPP (CPT® 76815) up to 2x weekly for the following conditions: - Antiphospholipid Syndrome. - Maternal Renal Disease (moderate to severe with creatinine >1.4mg/dl). - Sickle cell disease.
# Starting at diagnosis, perform BPP (CPT® 76818 or CPT® 76819) if ≥26 weeks, or modified BPP (CPT® 76815) if ≥23 weeks, up to 2x weekly for the following conditions: - Intra-hepatic cholestasis of pregnancy (IHCP). - Complicated Sickle cell disease (e.g. co-existing hypertension, vaso-occlusive crisis, fetal growth restriction). - Complicated SLE (e.g. active lupus nephritis, or recent flares). - Major fetal anomaly in the current pregnancy (e.g. gastroschisis, fetal ventriculomegaly, fetal hydronephrosis (>10mm), achondroplasias, fetal congenital heart disease, neural tube defect, sustained fetal arrhythmias).
# """

# question = "I would like comprehensive guidelines for placenta previa along with CPT reports.if there is any.\n"

# prompt_template = f""" Please adhere closely to the provided <Sample Output> and ensure that your response should be concise with Structured bullet point.
# [STRICT RULES TO FOLLOW WHILE GIVING ANSWER]
#     1.Answer questions based solely on provided context. do not infer or generate your own answers.
#     2.if no relevant answer found in Context then say and only say "No specific CPT reports are mentioned in the context"
#     2.If the key analysis suggests that the condition is considered normal, commonly encountered,common finding or benign, your response should strictly say and only say following in Recommendation... Recommendation: "No Recommendation Needed Cause Findind is Normal"

# [Sample Question]
#     I would like comprehensive guidelines for the AC value 8% along with CPT reports.\n"
# [Sample Output] 
#     Key Analysis: AC < 10%, The ACOG definition of Fetal Growth Restriction (FGR): Estimated or
#         actual weight of the fetus ≤10th percentile for gestational age, and/or Abdominal
#         Circumference ≤10th percentile.
#     Recommendation:
#         • Detailed Fetal Anatomic Scan (CPT® 76811) at diagnosis if not already performed
#         • Starting at 26 weeks, BPP (CPT® 76818 or CPT® 76819) or a modified BPP (CPT® 76815)
#         can be performed once or twice weekly
#         • Starting at 23 weeks Umbilical artery (UA) Doppler (CPT® 76820) can be performed
#         weekly
#         • Starting at diagnosis, if ≥16 weeks gestation, follow up ultrasound (CPT® 76816) can be
#         performed every 2 to 4 weeks if complete anatomy ultrasound previously performed

# Context : {context}
# """

# def get_completion(prompt, model="gpt-3.5-turbo"):
#     # messages = [{"role": "user", "content": prompt}]
#     response = openai.ChatCompletion.create(
#         model=model,
#         messages=prompt,
#         temperature=0.4  # this is the degree of randomness of the model's output
#     )
#     return response.choices[0].message["content"]

# output = get_completion([{"role": "system", "content": prompt_template}, {
#                                     "role": "user", "content": f"{question}" }])
# print(output)